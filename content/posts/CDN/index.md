---
title: "CDN"
date: 2020-07-09T13:01:13+08:00
tags: ["web"]
description: "五分钟带你了解CDN。"
summary: "五分钟带你了解CDN。"
---

> 五分钟带你了解CDN。

## 是什么

CDN（Content Delivery Network），即内容分发网络。

## 原理

尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定。

通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。

![](https://imgkr.cn-bj.ufileos.com/017243d6-ea09-4e10-9318-0a67689fb7d4.jpg)

## 过程

1. 当用户点击APP上的内容，APP会根据URL地址去**本地DNS**（域名解析系统）寻求IP地址解析。
2. 本地DNS系统会将域名的解析权交给**CDN专用DNS服务器**。
3. CDN专用DNS服务器，将CDN的全局负载均衡设备IP地址返回用户。
4. 用户向**CDN的负载均衡设备**发起内容URL访问请求。
5. CDN负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的**缓存服务器**。
6. 负载均衡设备告诉用户这台缓存服务器的IP地址，让用户向所选择的缓存服务器发起请求。
7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。
8. 如果这台缓存服务器上并没有用户想要的内容，那么这台缓存服务器就要网站的**源服务器**请求内容。
9. 源服务器返回内容给缓存服务器，缓存服务器发给用户，并根据用户自定义的缓存策略，判断要不要把内容缓存到缓存服务器上。

## 目的

1. 使用户可就近取得所需内容，解决Internet网络拥挤的状况，提高用户访问网站的响应速度。
2. 内容有吸引力
3. 访问速度快
4. 支持频繁的用户互动
5. 可以在各处浏览无障碍

## 回源问题

### 回源是什么

客户端请求资源，在DNS缓存服务器上找不到对应资源，然后到上一级服务器上面找，递归下去，如果一直没有找到，就会到服务端地址上面请求资源。这就是回源。

### 原因

1. 缓存失效（超出缓存时间，缓存内容变更等
2. 缓存资源不存在
3. 资源不缓存

## 劫持

### CDN劫持发生的原因？

一般情况下，在我们访问cdn服务器的时候，请求是https的，这个时候没发生劫持，在我们更改文件的时候，cdn服务器上没有对应资源，发生回源，用http访问服务器的时候，发生了劫持。

### 如何解决

- 利用SRI

script标签上有个属性，作用是防止篡改。

举个栗子：

```html
<script type="text/javascript" src="//s.url.cn/xxxx/aaa.js" integrity="sha256-xxx sha384-yyy" crossorigin="anonymous"></script>
```

## 不适合使用的场景

1. **具有强针对性的和特定的小范围用户群**
2. **极端本地化用户群**
3. **监管和复杂的治理要求**

## 参考文章

1. <https://www.zhihu.com/question/36514327/answer/193768864>
2. <https://developer.mozilla.org/zh-CN/docs/Web/Security/%E5%AD%90%E8%B5%84%E6%BA%90%E5%AE%8C%E6%95%B4%E6%80%A7>
